

<!DOCTYPE html>
<html>
<head>
    <style type="text/css">

        /* Legend Font Style */
        body {
            font: 11px sans-serif;
            background-color: #ffffff;
        }

        /* Legend Position Style */
        .legend {
            position:absolute;
            left:20px;
            top:30px;
        }

        .axis text {
            font: 10px sans-serif;
        }

        .axis line, .axis path {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

    </style>

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="static/css/main.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="static/js/main.js" type="text/javascript"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body style = "background-color: #878d92">
    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <a href = "#">Pollutants analysis</a>
    </div>

    <div id="main">
        <span style="font-size:30px;cursor:pointer" onclick="openNav()">&#9776; Menu</span>
    </div>

    <div class="container">
        <div class="row">

            <div class = "col-6" style= "margin-left:60px" >
<!--                <div class="dropdown">-->
<!--                    <button onclick="myFunction()" style= "margin-left:60px"  class="dropbtn">Year</button>-->
<!--                    <div id="inyear" class="dropdown-content">-->
<!--                        <a value="2018">2018</a>-->
<!--                        <a value="2017">2017</a>-->
<!--                        <a value="2016">2016</a>-->
<!--                        <a value="2015">2015</a>-->
<!--                        <a value="2014">2014</a>-->
<!--                        <a value="2013">2013</a>-->
<!--                        <a value="2012">2012</a>-->
<!--                        <a value="2011">2011</a>-->
<!--                        <a value="2010">2010</a>-->
<!--                        <a value="2009">2009</a>-->
<!--                        <a value="2008">2008</a>-->
<!--                        <a value="2007">2007</a>-->
<!--                        <a value="2006">2006</a>-->
<!--                        <a value="2005">2005</a>-->
<!--                        <a value="2004">2004</a>-->
<!--                        <a value="2003">2003</a>-->
<!--                        <a value="2002">2002</a>-->
<!--                        <a value="2001">2001</a>-->
<!--                        <a value="2000">2000</a>-->
<!--                        <a value="1999">1999</a>-->

<!--                    </div>-->
<!--                </div>-->

<!--                <div class="dropdown">-->
<!--                    <button onclick="myFunction1()" style= "margin-left:50px" class="dropbtn">Pollutant</button>-->
<!--                    <div id="inpoll" class="dropdown-content">-->
<!--                        <a value="NO2">NO2</a>-->
<!--                        <a value="O3">O3</a>-->
<!--                        <a value="SO2">SO2</a>-->
<!--                        <a value="CO">CO</a>-->
<!--                    </div>-->
<!--                </div>-->


                <select onchange="get_map()" id = "year">
                    <option value="2018">2018</option>
                    <option value="2017">2017</option>
                    <option value="2016">2016</option>
                    <option value="2015">2015</option>
                    <option value="2014">2014</option>
                    <option value="2013">2013</option>
                    <option value="2012">2012</option>
                    <option value="2011">2011</option>
                    <option value="2010">2010</option>
                    <option value="2009">2009</option>
                    <option value="2008">2008</option>
                    <option value="2007">2007</option>
                    <option value="2006">2006</option>
                    <option value="2005">2005</option>
                    <option value="2004">2004</option>
                    <option value="2003">2003</option>
                    <option value="2002">2002</option>
                    <option value="2001">2001</option>
                    <option value="2000">2000</option>
                    <option value="1999">1999</option>\
                </select>

                <select onchange="get_map()" id="pollutant">
                    <option value="NO2">NO2</option>
                    <option value="O3">O3</option>
                    <option value="SO2">SO2</option>
                    <option value="CO">CO</option>
                </select>

            </div>
            <div class = "col-6"></div>

        </div>
    </div>



<script>


d3.select('#mySidenav').selectAll('a').on('click', get_map);

// d3.select('#inyear').selectAll('a').on('click', function(){ update_map("year")});
// d3.select('#inpoll').selectAll('a').on('click',function(){ update_map("poll")});


function bar_chart(data) {

}

function choropleth(data){

var data = JSON.parse(data);
var state = data["State"];
var value = data[Object.keys(data)[1]];

//Width and height of map
    var width = 960;
    var height = 350;

    var lowColor = '#f9f9f9'
    var highColor = '#bc2a66'

// D3 Projection
    var projection = d3.geoAlbersUsa()
        .translate([width / 2, height / 2]) // translate to center of screen
        .scale([700]); // scale things down so see entire US

// Define path generator
    var path = d3.geoPath() // path generator that will convert GeoJSON to SVG paths
        .projection(projection); // tell path generator to use albersUsa projection

//Create SVG element and append map to the SVG
    var svg = d3.select("body")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
.append("g")
        .attr("transform",
            "translate(" + 10 + "," + 0 + ")");

// Load in my states data!

     var values = Object.keys(value).map(function(key) {
        return value[key];
    });
     console.log(values);
        var minVal = d3.min(values)
        var maxVal = d3.max(values)

        var ramp = d3.scaleLinear().domain([minVal,maxVal]).range([lowColor,highColor])
        // Load GeoJSON data and merge with states data
        d3.json("static/us-states.json", function(json) {
            for (var j = 0; j < json.features.length; j++) {
                json.features[j].properties.value = 0;

            }

            // Loop through each state data value in the .csv file
            for (var i = 0; i < 42; i++) {

                // Grab State Name
                var dataState = state[i];

                // Grab data value
                var dataValue = value[i];

                // Find the corresponding state inside the GeoJSON

                for (var j = 0; j < json.features.length; j++) {
                    var jsonState = json.features[j].properties.name;

                    if (dataState == jsonState) {
                    console.log("found");
                        // Copy the data value into the JSON
                        json.features[j].properties.value = dataValue;

                        // Stop looking through the JSON
                        break;
                    }


                }

            }

            // Bind the data to the SVG and create one path per GeoJSON feature
            svg.selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("stroke", "#fff")
                .style("stroke-width", "1")
                .style("fill", function(d) { return ramp(d.properties.value) });

            // add a legend
            var w = 140, h = 300;

            var key = d3.select("body")
                .append("svg")
                .attr("width", w)
                .attr("height", h)
                .attr("class", "legend")
                .attr("transform",
                    "translate(" + 70 + "," + 70 + ")");

            var legend = key.append("defs")
                .append("svg:linearGradient")
                .attr("id", "gradient")
                .attr("x1", "100%")
                .attr("y1", "0%")
                .attr("x2", "100%")
                .attr("y2", "100%")
                .attr("spreadMethod", "pad");

            legend.append("stop")
                .attr("offset", "0%")
                .attr("stop-color", highColor)
                .attr("stop-opacity", 1);

            legend.append("stop")
                .attr("offset", "100%")
                .attr("stop-color", lowColor)
                .attr("stop-opacity", 1);

            key.append("rect")
                .attr("width", w - 100)
                .attr("height", h)
                .style("fill", "url(#gradient)")
                .attr("transform", "translate(0,10)");

            var y = d3.scaleLinear()
                .range([h, 0])
                .domain([minVal, maxVal]);

            var yAxis = d3.axisRight(y);

            key.append("g")
                .attr("class", "y axis")
                .attr("transform", "translate(41,10)")
                .call(yAxis)
        });


}


function update_map(val)
{
    var option = d3.select(this).text();

}


function get_map() {
d3.selectAll('svg').remove();
var opt = d3.select(this).text();
// if (opt=="Pollutants analysis")
//    url = "/us_map"




$.ajax({
    url: "/us_map",
    type: "POST",
    contentType: "application/json",
    data: JSON.stringify({ "year": document.getElementById("year").value,
                             "pollutant":document.getElementById('pollutant').value})
}).done(function(data) {
    // if (opt=="Pollutants analysis"){

        console.log(data);
        choropleth(data)
    // }

});




}

</script>
</body>

</html>
